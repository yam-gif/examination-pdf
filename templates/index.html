<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>基礎問ジェネレーター</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Noto+Sans+JP:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#d4af37;--primary-light:#e6c861;
      --text:#e0e0e0;--text-dim:#b0b0b0;
      --chip-bg:#1b1b1b;--chip-checked:rgba(212,175,55,.15);
    }
    *{box-sizing:border-box;margin:0}
    body{
      min-height:100vh;display:flex;align-items:center;justify-content:center;
      font-family:'Noto Sans JP',sans-serif;color:var(--text);
      background:radial-gradient(circle at 30% 10%,#000,#070707);
    }
    .container{
      width:92%;max-width:880px;padding:2.3rem 2.8rem;
      background:rgba(241,244,241,.08); /* 少し透明度を調整 */
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;backdrop-filter:blur(18px) saturate(120%);
      box-shadow:0 0 30px rgba(212,175,55,.1),0 0 25px rgba(212,175,55,.05);
      position:relative;
    }
    h1{margin-bottom:2.2rem;font:700 2rem/1 'Playfair Display',serif;text-align:center;letter-spacing:.04em;color:var(--primary);}
    .form{display:grid;gap:1.8rem}
    @media(min-width:640px){.form{grid-template-columns:repeat(2,1fr)} .form .btn-generate{grid-column:span 2;justify-self:center}}
    fieldset{border:none;padding:0}
    .field-group{border:1px solid #222;border-radius:10px;padding:1.2rem 1.4rem}
    .field-group legend{font-weight:500;color:var(--primary);padding:0 .2rem}
    .options{display:flex;flex-wrap:wrap;gap:.6rem}
    .options input{display:none}
    .options label{
      position:relative;padding:.55rem .95rem;border-radius:24px;background:var(--chip-bg);color:var(--text-dim);
      cursor:pointer;font-size:.9rem;transition:background .25s,color .25s,transform .15s;
    }
    .options input:checked+label{color:var(--primary);background:var(--chip-checked);box-shadow:0 0 4px rgba(212,175,55,.5) inset;}
    .btn{
      display:inline-block;padding:.9rem 1.8rem;border:2px solid var(--primary);
      background:var(--primary);color:#000;font-weight:700;font-size:1rem;
      border-radius:8px;text-align:center;cursor:pointer;transition:background .25s;
    }
    .btn:hover{background:var(--primary-light)}
    #copy-msg{display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:1rem 1.3rem;border-radius:8px;background:var(--primary);color:#000;font-weight:700;z-index:1000;}
    .result{margin-top:2.8rem}
    pre{margin-top:1rem;padding:1.2rem 1.4rem;background:#0d0d0d;border:1px solid #222;border-radius:10px;white-space:pre-wrap;line-height:1.55;color:var(--text);overflow-x:auto}
  </style>
</head>
<body>
  <div id="copy-msg">コピーしました！</div>
  <div class="container">
    <h1>基礎問題精講ジェネレーター</h1>

    <form action="/generate" method="post" class="form">
      <fieldset class="field-group">
        <legend>科目 を選択</legend>
        <div class="options">
          {% for subj in subjects %}
            <input type="checkbox" id="s{{ loop.index }}" name="subject" value="{{ subj }}" {% if subj in selected_subjects %}checked{% endif %}>
            <label for="s{{ loop.index }}">{{ subj }}</label>
          {% endfor %}
        </div>
      </fieldset>

      <fieldset class="field-group">
        <legend>単元 を選択</legend>
        <div class="options">
          {% for cat in categories %}
            <input type="checkbox" id="c{{ loop.index }}" name="category" value="{{ cat }}" {% if cat in selected_categories %}checked{% endif %}>
            <label for="c{{ loop.index }}">{{ cat }}</label>
          {% endfor %}
        </div>
      </fieldset>

      <fieldset class="field-group">
        <legend>問題形式 を選択</legend>
        <div class="options">
          {% for diff in difficulties %}
            <input type="checkbox" id="d{{ loop.index }}" name="difficulty" value="{{ diff }}" {% if diff in selected_difficulties %}checked{% endif %}>
            <label for="d{{ loop.index }}">{{ diff }}</label>
          {% endfor %}
        </div>
      </fieldset>

      <fieldset class="field-group">
        <legend>出題数</legend>
        <div class="options">
          {% for n in num_choices %}
            <input type="radio" id="n{{ n }}" name="num_questions" value="{{ n }}" {% if n == selected_num %}checked{% endif %}>
            <label for="n{{ n }}">{{ n }} 問</label>
          {% endfor %}
        </div>
      </fieldset>

      <button type="submit" class="btn btn-generate">問題を生成</button>
    </form>

    {% if latex %}
    <div class="result">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>問題用 LaTeX コード</h2>
        <button id="copy-prob-btn" class="btn" style="padding:0.5rem 1rem; font-size:0.8rem;">コピー</button>
      </div>
      <pre id="prob-code">{{ latex | e }}</pre>
    </div>
    {% endif %}
  </div>

  <script>
    const setupCopy = (btnId, preId) => {
      const btn = document.getElementById(btnId);
      const pre = document.getElementById(preId);
      if(!btn || !pre) return;
      btn.addEventListener('click', async () => {
        try{
          await navigator.clipboard.writeText(pre.innerText);
          const m = document.getElementById('copy-msg');
          m.style.display='block';
          setTimeout(()=>{m.style.display='none';},2000);
        }catch{alert('コピーに失敗しました');}
      });
    };
    setupCopy('copy-prob-btn','prob-code');
  </script>
</body>
</html>